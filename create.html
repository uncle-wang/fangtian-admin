<!doctype html>
<html>
	<head>
		<title>创建</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<script type="text/javascript" src="jquery.min.js"></script>
	</head>
	<body>
		<div><label>id</label><input id="game_id" type="text"></div>
		<div id="disable">
			<label>封盘时间</label>
			<input type="text" name="year" value="2018">
			<label>年</label>
			<input type="text" name="month" value="4">
			<label>月</label>
			<input type="text" name="date">
			<label>日</label>
			<input type="text" name="hour" value="14">
			<label>时</label>
			<input type="text" name="minute" value="30">
			<label>分</label>
		</div>
		<div id="close">
			<label>结束时间</label>
			<input type="text" name="year" value="2018">
			<label>年</label>
			<input type="text" name="month" value="4">
			<label>月</label>
			<input type="text" name="date">
			<label>日</label>
			<input type="text" name="hour" value="15">
			<label>时</label>
			<input type="text" name="minute" value="30">
			<label>分</label>
		</div>
		<a id="submit">创建</a>
		<script type="text/javascript">
			var getTime = function(type) {
				var year = $('#' + type + ' input[name="year"]').val();
				var month = parseInt($('#' + type + ' input[name="month"]').val()) - 1;
				var date = $('#' + type + ' input[name="date"]').val();
				var hour = $('#' + type + ' input[name="hour"]').val();
				var minute = $('#' + type + ' input[name="minute"]').val();
				var d = new Date(year, month, date, hour, minute);
				return d.getTime();
			};
			$('#submit').click(function() {

				var arr = $('input[type="text"]');
				for (var i = 0; i < arr.length; i ++) {
					if (!$(arr[i]).val()) {
						alert('请填写所有项');
						return;
					}
				}

				var gameId = $('#game_id').val();
				var disableTime = getTime('disable');
				var closeTime = getTime('close');
				$.ajax({
					url: '/api/admin/createGame',
					data: {
						id: gameId,
						disable_time: disableTime,
						close_time: closeTime
					},
					success: function(data) {
						var status = data.status;
						if (status === 1001) {
							alert('未登录');
						}
						else if (status === 4003) {
							alert('存在未结束局');
						}
						else if (status === 1002) {
							alert('参数错误');
						}
						else if (status === 1000) {
							alert('创建成功');
						}
						else {
							alert('未知错误');
							if (data.desc) {
								alert(data.desc);
							}
						}
					},
					error: function() {
						alert('请求失败');
					}
				});
			});
		</script>
	</body>
</html>